<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Order Confirmed - Thank You! | Unshakable Family</title>

    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PLXHCM4T');</script>
    <!-- End Google Tag Manager -->

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #1a365d;
            --fire-red: #e63946;
            --gold: #ffd700;
            --text-dark: #1a202c;
            --text-light: #718096;
            --bg-light: #f7fafc;
            --success: #38a169;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background: var(--bg-light);
        }

        .success-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
        }

        .success-card {
            background: white;
            border-radius: 30px;
            padding: 60px 40px;
            max-width: 700px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            text-align: center;
        }

        .success-icon {
            width: 120px;
            height: 120px;
            background: var(--success);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 30px;
            animation: scaleIn 0.5s ease-out;
        }

        .success-icon i {
            font-size: 60px;
            color: white;
        }

        @keyframes scaleIn {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        h1 {
            font-size: clamp(32px, 5vw, 48px);
            font-weight: 900;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .order-number {
            font-size: 18px;
            color: var(--text-light);
            margin-bottom: 30px;
        }

        .success-message {
            font-size: 18px;
            color: var(--text-dark);
            line-height: 1.8;
            margin-bottom: 40px;
        }

        .bonus-alert {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border: 3px solid var(--gold);
            border-radius: 20px;
            padding: 30px;
            margin: 40px 0;
        }

        .bonus-alert h2 {
            font-size: 28px;
            color: var(--fire-red);
            margin-bottom: 15px;
        }

        .bonus-alert ul {
            list-style: none;
            padding: 0;
            margin: 20px 0;
            text-align: left;
        }

        .bonus-alert li {
            padding: 12px 0;
            padding-left: 35px;
            position: relative;
            font-size: 16px;
            color: var(--text-dark);
        }

        .bonus-alert li::before {
            content: "游꾸";
            position: absolute;
            left: 0;
            font-size: 24px;
        }

        .info-boxes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }

        .info-box {
            background: var(--bg-light);
            padding: 25px;
            border-radius: 15px;
            text-align: left;
        }

        .info-box h3 {
            font-size: 20px;
            color: var(--primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-box h3 i {
            font-size: 24px;
            color: var(--fire-red);
        }

        .info-box p {
            color: var(--text-light);
            font-size: 15px;
            line-height: 1.7;
        }

        .cta-section {
            margin-top: 50px;
            padding-top: 40px;
            border-top: 2px solid var(--bg-light);
        }

        .btn {
            display: inline-block;
            padding: 18px 40px;
            font-size: 18px;
            font-weight: 700;
            text-decoration: none;
            border-radius: 50px;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .btn-primary {
            background: var(--fire-red);
            color: white;
        }

        .btn-primary:hover {
            background: #c53030;
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(230, 57, 70, 0.3);
        }

        .btn-secondary {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
        }

        .social-share {
            margin-top: 40px;
        }

        .social-share h3 {
            font-size: 18px;
            color: var(--text-dark);
            margin-bottom: 15px;
        }

        .social-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .social-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-decoration: none;
            font-size: 22px;
            transition: all 0.3s ease;
        }

        .social-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .social-btn.facebook { background: #1877f2; }
        .social-btn.twitter { background: #1da1f2; }
        .social-btn.email { background: var(--text-dark); }

        @media (max-width: 768px) {
            .success-card {
                padding: 40px 25px;
            }

            .info-boxes {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PLXHCM4T"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <div class="success-container">
        <div class="success-card">
            <div class="success-icon">
                <i class="fas fa-check"></i>
            </div>

            <h1>Order Confirmed! 游꿀</h1>
            <p class="order-number" id="orderNumber">Order #<span id="orderNumberValue">Loading...</span></p>

            <p class="success-message">
                Thank you for your purchase! Your order has been confirmed and is being prepared for shipment. 
                You'll receive a confirmation email shortly with all the details.
            </p>

            <div class="bonus-alert" id="bonusAlert">
                <h2>游꾸 Check Your Email for Your FREE Bonuses!</h2>
                <p style="margin-bottom: 20px;">Within the next few minutes, you'll receive an email with instant access to:</p>
                <ul id="bonusList">
                    <!-- Bonuses will be populated dynamically based on purchase -->
                </ul>
                <p style="font-size: 14px; color: var(--text-light); margin-top: 20px;">
                    <em>Don't see it? Check your spam/promotions folder and add us to your contacts!</em>
                </p>
            </div>

            <div class="info-boxes">
                <div class="info-box">
                    <h3>
                        <i class="fas fa-shipping-fast"></i>
                        Shipping
                    </h3>
                    <p>Your books will ship within 1-2 business days. You'll receive tracking information via email.</p>
                </div>

                <div class="info-box">
                    <h3>
                        <i class="fas fa-envelope"></i>
                        Bonuses
                    </h3>
                    <p>Check your email for instant access to your free digital guides. Download and start today!</p>
                </div>

                <div class="info-box">
                    <h3>
                        <i class="fas fa-shield-alt"></i>
                        Guarantee
                    </h3>
                    <p>30-day money-back guarantee. Not satisfied? Return for a full refund, no questions asked.</p>
                </div>
            </div>

            <div class="cta-section">
                <h3 style="margin-bottom: 20px; color: var(--primary);">What's Next?</h3>
                <p style="margin-bottom: 30px; color: var(--text-light);">
                    While you wait for your books to arrive, download your bonus guides and start transforming your family today!
                </p>
                
                <a href="https://bridgebuilders.net" class="btn btn-primary">
                    <i class="fas fa-globe"></i> Visit BridgeBuilders
                </a>
                <a href="/" class="btn btn-secondary">
                    <i class="fas fa-book"></i> Back to Home
                </a>
            </div>

            <div class="social-share">
                <h3>Share the Good News:</h3>
                <div class="social-buttons">
                    <a href="#" class="social-btn facebook" onclick="shareOnFacebook(); return false;" title="Share on Facebook">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="#" class="social-btn twitter" onclick="shareOnTwitter(); return false;" title="Share on Twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="#" class="social-btn email" onclick="shareViaEmail(); return false;" title="Share via Email">
                        <i class="fas fa-envelope"></i>
                    </a>
                </div>
            </div>

            <div style="margin-top: 50px; padding-top: 30px; border-top: 1px solid var(--bg-light);">
                <p style="font-size: 14px; color: var(--text-light);">
                    Questions? Contact us at <a href="mailto:support@bridgebuilders.net" style="color: var(--fire-red); text-decoration: none;">support@bridgebuilders.net</a>
                </p>
            </div>
        </div>
    </div>

    <script>
        // Product details mapping (matches cart.html exactly)
        const PRODUCT_DETAILS = {
            'prod_TKMYdi0tJ8PihI': {
                name: 'Unshakable Family Bundle (English)',
                price: 30.00,
                type: 'bundle',
                language: 'English',
                stripePriceId: 'price_1SNhpqENTZGZDoIEfi6rFMQN'
            },
            'prod_TKMZUqoZ3N0UqW': {
                name: 'Unshakable Family Bundle (Espa침ol)',
                price: 30.00,
                type: 'bundle',
                language: 'Espa침ol',
                stripePriceId: 'price_1SNhqTENTZGZDoIEeEG3CazL'
            },
            'prod_TKMQIIUotITNZo': {
                name: 'Unshakable Paperback',
                price: 17.99,
                type: 'paperback',
                language: 'English',
                stripePriceId: 'price_1SNhhNENTZGZDoIEJ1qhRhFI'
            },
            'prod_TKMSsIjIYBf5Ev': {
                name: 'Unshakable Paperback',
                price: 17.99,
                type: 'paperback',
                language: 'Espa침ol',
                stripePriceId: 'price_1SNhj9ENTZGZDoIEade9RdRT'
            },
            'prod_TKMTKRgsWddE83': {
                name: 'Unshakable Ebook',
                price: 9.99,
                type: 'ebook',
                language: 'English',
                stripePriceId: 'price_1SNhkLENTZGZDoIELjfoA8tY'
            },
            'prod_TKMTfrTuMRr7c3': {
                name: 'Unshakable Ebook',
                price: 9.99,
                type: 'ebook',
                language: 'Espa침ol',
                stripePriceId: 'price_1SNhkZENTZGZDoIEjl4bfDHk'
            },
            'prod_TKMUdCfcPzrqrm': {
                name: 'Fire on the Family Altar Paperback',
                price: 17.99,
                type: 'paperback',
                language: 'English',
                stripePriceId: 'price_1SNhl7ENTZGZDoIEdv8igmrL'
            },
            'prod_TKMUV9sItr20yy': {
                name: 'Fire on the Family Altar Paperback',
                price: 17.99,
                type: 'paperback',
                language: 'Espa침ol',
                stripePriceId: 'price_1SNhlTENTZGZDoIETaFD5Pap'
            },
            'prod_TKMU12ym0FzbZM': {
                name: 'Fire on the Family Altar Ebook',
                price: 9.99,
                type: 'ebook',
                language: 'English',
                stripePriceId: 'price_1SNhlmENTZGZDoIEH9KmZcwY'
            },
            'prod_TKMVhWKaAW2sZf': {
                name: 'Fire on the Family Altar Ebook',
                price: 9.99,
                type: 'ebook',
                language: 'Espa침ol',
                stripePriceId: 'price_1SNhm4ENTZGZDoIEbQtJY67i'
            },
            'rec_prayer_saturated_church': {
                name: 'Prayer Saturated Church',
                price: 17.99,
                type: 'paperback',
                language: 'English',
                stripePriceId: 'price_1SO7xQENTZGZDoIEwuTNlQh4',
                isRecommendation: true
            },
            'rec_prayer_saturated_family': {
                name: 'Prayer Saturated Family',
                price: 17.99,
                type: 'paperback',
                language: 'English',
                stripePriceId: 'price_1SO80EENTZGZDoIEzA7pWAe4',
                isRecommendation: true
            },
            'rec_prayer_saturated_kids': {
                name: 'Prayer Saturated Kids',
                price: 13.99,
                type: 'paperback',
                language: 'English',
                stripePriceId: 'price_1SO81oENTZGZDoIE4LcprMsj',
                isRecommendation: true
            },
            'rec_prayer_saturated_kids_es': {
                name: 'Ni침os Saturados de Oraci칩n',
                price: 13.99,
                type: 'paperback',
                language: 'Espa침ol',
                stripePriceId: 'price_1SO82eENTZGZDoIEousRiLA5',
                isRecommendation: true
            },
            'rec_reclaim_generation': {
                name: 'Reclaim a Generation',
                price: 10.79,
                type: 'paperback',
                language: 'English',
                stripePriceId: 'price_1SO83OENTZGZDoIELTB7Ea3k',
                isRecommendation: true
            },
            'rec_two_nations': {
                name: 'Two Nations One Prayer',
                price: 10.99,
                type: 'paperback',
                language: 'English',
                stripePriceId: 'price_1SO84GENTZGZDoIEgLiDJL3a',
                isRecommendation: true
            },
            'rec_two_nations_es': {
                name: 'Dos Naciones Una Oraci칩n',
                price: 10.99,
                type: 'paperback',
                language: 'Espa침ol',
                stripePriceId: 'price_1SO85VENTZGZDoIEMQ2ujNqG',
                isRecommendation: true
            },
            'prod_TL15QCP70baXz8': {
                name: '30-Day Unshakable Action Guide',
                price: 0.00,
                type: 'bonus',
                language: 'English',
                stripePriceId: 'price_1SOL2yENTZGZDoIEndRZQzvZ',
                isFreeBonus: true
            },
            'prod_TL15L4IFBZtld8': {
                name: '10-Day Family Prayer Guide',
                price: 0.00,
                type: 'bonus',
                language: 'English',
                stripePriceId: 'price_1SOL3RENTZGZDoIEyoSJ4lFh',
                isFreeBonus: true
            }
        };

        // Get session ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const sessionId = urlParams.get('session_id');

        if (sessionId) {
            document.getElementById('orderNumberValue').textContent = sessionId.substr(sessionId.length - 12);
        } else {
            document.getElementById('orderNumberValue').textContent = 'Confirmed';
        }

        // Get cart data before clearing for purchase tracking
        let cart = [];
        try {
            const cartData = localStorage.getItem('unshakableCart');
            if (cartData) {
                cart = JSON.parse(cartData);
            }
        } catch (e) {
            console.error('Error reading cart data:', e);
        }

        // Determine which bonuses to show based on purchase
        function displayBonuses(cart) {
            const bonusList = document.getElementById('bonusList');
            const bonusAlert = document.getElementById('bonusAlert');

            if (cart.length === 0) {
                // If no cart data, hide bonus section
                bonusAlert.style.display = 'none';
                return;
            }

            const bonuses = [];

            // Check what was purchased
            const hasUnshakable = cart.some(item => {
                const product = PRODUCT_DETAILS[item.id];
                return item.id.includes('unshakable') || item.id.includes('bundle');
            });

            const hasFire = cart.some(item => {
                const product = PRODUCT_DETAILS[item.id];
                return item.id.includes('fire') || item.id.includes('bundle');
            });

            // Add bonuses based on purchase
            if (hasUnshakable) {
                bonuses.push('<li><strong>30-Day Unshakable Action Guide</strong> ($29.95 value)</li>');
            }

            if (hasFire) {
                bonuses.push('<li><strong>10-Day Family Prayer Guide</strong> ($19.95 value)</li>');
            }

            // Populate the bonus list
            if (bonuses.length > 0) {
                bonusList.innerHTML = bonuses.join('');
            } else {
                // Hide bonus alert if no bonuses
                bonusAlert.style.display = 'none';
            }
        }

        // Display bonuses based on cart
        displayBonuses(cart);

        // Track purchase event with GA4 e-commerce
        if (cart.length > 0) {
            const subtotal = cart.reduce((sum, item) => {
                const product = PRODUCT_DETAILS[item.id];
                return sum + (product.price * item.quantity);
            }, 0);

            const hasRecommendation = cart.some(item => PRODUCT_DETAILS[item.id].isRecommendation);
            const discount = hasRecommendation ? subtotal * 0.10 : 0;
            const total = subtotal - discount;

            window._mfq = window._mfq || [];
            window._mfq.push(["tag", "purchase-completed"]);

            window.dataLayer = window.dataLayer || [];
            window.dataLayer.push({
                event: 'purchase',
                ecommerce: {
                    transaction_id: sessionId || 'unknown',
                    value: total,
                    tax: 0,
                    shipping: 0, // Shipping is added by Stripe
                    currency: 'USD',
                    coupon: hasRecommendation ? 'RECOMMENDATION_10' : '',
                    items: cart.map(item => {
                        const product = PRODUCT_DETAILS[item.id];
                        return {
                            item_id: item.id,
                            item_name: product.name,
                            item_category: product.type === 'ebook' ? 'Ebook' : (product.type === 'bundle' ? 'Bundle' : 'Paperback'),
                            item_category2: product.language === 'english' ? 'English' : 'Spanish',
                            price: product.price,
                            quantity: item.quantity
                        };
                    })
                }
            });

            console.log('Purchase tracked:', { transaction_id: sessionId, value: total, items: cart.length });
        }

        // Clear cart after successful purchase
        localStorage.removeItem('unshakableCart');

        // Social sharing functions
        function shareOnFacebook() {
            // Track share
            window.dataLayer = window.dataLayer || [];
            window.dataLayer.push({
                event: 'share',
                share_method: 'facebook',
                content_type: 'order_confirmation',
                page_location: window.location.href
            });

            const url = 'https://unshakablefamily.bridgebuilders.net';
            const text = 'Just got the Unshakable Family resources from BridgeBuilders! Transform your family with these powerful books and guides.';
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}&quote=${encodeURIComponent(text)}`, '_blank', 'width=600,height=400');
        }

        function shareOnTwitter() {
            // Track share
            window.dataLayer = window.dataLayer || [];
            window.dataLayer.push({
                event: 'share',
                share_method: 'twitter',
                content_type: 'order_confirmation',
                page_location: window.location.href
            });

            const url = 'https://unshakablefamily.bridgebuilders.net';
            const text = 'Just got Unshakable Family resources from BridgeBuilders! 游닄游댠 Building foundations that last and igniting revival at home. Check it out:';
            window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`, '_blank', 'width=600,height=400');
        }

        function shareViaEmail() {
            // Track share
            window.dataLayer = window.dataLayer || [];
            window.dataLayer.push({
                event: 'share',
                share_method: 'email',
                content_type: 'order_confirmation',
                page_location: window.location.href
            });

            const subject = 'Check out Unshakable Family Resources from BridgeBuilders';
            const body = 'I just got the Unshakable Family resources from BridgeBuilders and wanted to share it with you!\n\nThese books and guides teach how to build unshakable foundations and ignite revival in your home.\n\nCheck it out: https://unshakablefamily.bridgebuilders.net';
            window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        }

        // Confetti animation (optional - can add confetti library)
        console.log('游꿀 Order successful! Thank you for your purchase!');
    </script>

    <!-- Universal GTM Tracking Library -->
    <script src="tracking.js"></script>
</body>
</html>
